{"version":3,"sources":["../src/deleteKeyPrefix.ts"],"names":["deleteKeyPrefix","s3","options","callback","listObjectsV2","err","data","KeyCount","objectsToDelete","Contents","map","s3Object","Key","deleteObjects","Bucket","Delete","Objects"],"mappings":";;;;;;;AAEA;;AAOO,SAASA,eAAT,CAAyBC,EAAzB,EAAiCC,OAAjC,EAAkEC,QAAlE,EAA+G;AACpHF,EAAAA,EAAE,CAACG,aAAH,CAAiBF,OAAjB,EAA0B,CAACG,GAAD,EAAMC,IAAN,KAAe;AACvC,QAAID,GAAJ,EAAS;AACPF,MAAAA,QAAQ,CAAC,8BAAeE,GAAf,CAAD,CAAR;AACD,KAFD,MAEO,IAAIC,IAAI,CAACC,QAAT,EAAmB;AACxB,YAAMC,eAAwC,GAAGF,IAAI,CAACG,QAAL,GAC7CH,IAAI,CAACG,QAAL,CAAcC,GAAd,CAAkBC,QAAQ,KAAK;AAAEC,QAAAA,GAAG,EAAED,QAAQ,CAACC;AAAhB,OAAL,CAA1B,CAD6C,GAE7C,EAFJ;AAGAX,MAAAA,EAAE,CAACY,aAAH,CACE;AACEC,QAAAA,MAAM,EAAEZ,OAAO,CAACY,MADlB;AAEEC,QAAAA,MAAM,EAAE;AAAEC,UAAAA,OAAO,EAAER;AAAX;AAFV,OADF,EAKEH,GAAG,IAAI;AACL,YAAIA,GAAJ,EAAS;AACPF,UAAAA,QAAQ,CAAC,8BAAeE,GAAf,CAAD,CAAR;AACD,SAFD,MAEO;AACLF,UAAAA,QAAQ,CAAC,IAAD,CAAR;AACD;AACF,OAXH;AAaD,KAjBM,MAiBA;AACLA,MAAAA,QAAQ,CAAC,+BAAD,CAAR;AACD;AACF,GAvBD;AAwBD","sourcesContent":["import { S3 } from 'aws-sdk';\n\nimport { convertS3Error, create404Error } from './s3Errors';\n\ninterface DeleteKeyPrefixOptions {\n  Bucket: string;\n  Prefix: string;\n}\n\nexport function deleteKeyPrefix(s3: S3, options: DeleteKeyPrefixOptions, callback: (err: Error | null) => void): void {\n  s3.listObjectsV2(options, (err, data) => {\n    if (err) {\n      callback(convertS3Error(err));\n    } else if (data.KeyCount) {\n      const objectsToDelete: S3.ObjectIdentifierList = data.Contents\n        ? data.Contents.map(s3Object => ({ Key: s3Object.Key as S3.ObjectKey }))\n        : [];\n      s3.deleteObjects(\n        {\n          Bucket: options.Bucket,\n          Delete: { Objects: objectsToDelete },\n        },\n        err => {\n          if (err) {\n            callback(convertS3Error(err));\n          } else {\n            callback(null);\n          }\n        }\n      );\n    } else {\n      callback(create404Error());\n    }\n  });\n}\n"],"file":"deleteKeyPrefix.js"}